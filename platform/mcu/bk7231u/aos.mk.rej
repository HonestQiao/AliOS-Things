--- platform/mcu/bk7231u/aos.mk
+++ platform/mcu/bk7231u/aos.mk
@@ -48,21 +50,18 @@
                   -nostartfiles             \
                   $(CLIB_LDFLAGS_NANO_FLOAT)
 
-BINS ?=
-
 PING_PONG_OTA := 1
 ifeq ($(PING_PONG_OTA),1)
-AOS_IMG1_XIP1_LD_FILE += platform/mcu/bk7231u/bk7231u.ld.S
-AOS_IMG2_XIP2_LD_FILE += platform/mcu/bk7231u/bk7231u_ex.ld.S
+GLOBAL_DEFINES += CFG_PING_PONG_OTA
+AOS_IMG1_XIP1_LD_FILE += platform/mcu/bk7231u/bk7231u.ld
+AOS_IMG2_XIP2_LD_FILE += platform/mcu/bk7231u/bk7231u_ex.ld
 else
-GLOBAL_LDS_FILES += platform/mcu/bk7231u/bk7231u.ld.S
+GLOBAL_LDS_FILES += platform/mcu/bk7231u/bk7231u.ld
 endif
-
-include ./platform/mcu/bk7231u/beken/beken.mk
 
 $(NAME)_INCLUDES += aos
 
-$(NAME)_SOURCES := aos/aos_main.c
+$(NAME)_SOURCES += aos/aos_main.c
 $(NAME)_SOURCES += aos/soc_impl.c
 
 $(NAME)_SOURCES += hal/gpio.c        \
@@ -70,27 +69,30 @@
                    hal/hw.c          \
                    hal/flash.c       \
                    hal/uart.c        \
-                   hal/ringbuf.c     \
                    hal/StringUtils.c \
                    hal/wifi_port.c   \
                    hal/beken_rhino.c \
+                   hal/pwm.c \
                    hal_init/hal_init.c
 
-ifneq ($(filter umesh,$(COMPONENTS)),)
-$(NAME)_SOURCES +=  hal/mesh_wifi_hal.c
-endif
+$(NAME)_SOURCES += hal/pwrmgmt_hal/board_cpu_pwr.c \
+                   hal/pwrmgmt_hal/board_cpu_pwr_systick.c \
+                   hal/pwrmgmt_hal/board_cpu_pwr_timer.c
 
-GLOBAL_INCLUDES += beken/driver/ble/rw_ble/ip/ble/profiles/AIS/api
-$(NAME)_SOURCES += hal/ble.c
-$(NAME)_SOURCES += hal/breeze_hal_os.c
+#Beken ip
+#$(NAME)_PREBUILT_LIBRARY += beken/ip/ip.a
+$(NAME)_COMPONENTS += beken_ip
 
-ifneq ($(filter pwrmgmt,$(COMPONENTS)),)
-$(NAME)_SOURCES +=  hal/pwrmgmt_hal/board_cpu_pwr.c \
-                    hal/pwrmgmt_hal/board_cpu_pwr_systick.c \
-                    hal/pwrmgmt_hal/board_cpu_pwr_timer.c
-endif
+#Beken BLE
+btstack := vendor
+GLOBAL_DEFINES  += BLE_4_2
+GLOBAL_DEFINES  += BLE_ADV_ASYN
+$(NAME)_SOURCES += hal/breeze_hal/breeze_hal_ble.c
+$(NAME)_SOURCES += hal/breeze_hal/breeze_hal_os.c
+$(NAME)_SOURCES += hal/breeze_hal/breeze_hal_sec.c
+$(NAME)_COMPONENTS += ble_lib
 
-GLOBAL_LDFLAGS += -Wl,--wrap=boot_undefined
-GLOBAL_LDFLAGS += -Wl,--wrap=boot_pabort
-GLOBAL_LDFLAGS += -Wl,--wrap=boot_dabort
+#Beken entry
+$(NAME)_COMPONENTS += beken_entry
 
+include ./platform/mcu/bk7231u/beken/beken.mk
